# **<経路保存>** 画面の詳細仕様

## 呼び出し画面

- **<メイン>** 画面
  - `BottomNavigation`の``[保存]``アイコン (`SaveIcon`)

## 入力パラメーター

- `currentRoute: Farert` (メイン画面の現在の経路)

## レイアウト

### 1行目 画面タイトル

- 左端: `[戻る]`アイコン (`ArrowBackIcon`)
- 中央: "保持経路"
- 右端: `[編集]`ボタン (`EditIcon`) / `[完了]`ボタン (`CheckIcon`、編集モード時)

### リスト表示エリア

`component-design.md`で定義されている`SavedRouteCard`コンポーネントを、現在の経路と保存された複数の経路に対して表示します。

-   **現在の経路 (`currentRoute`)**:
    -   先頭に表示されます。
    -   保存されていない場合: `SavedRouteCard`は`isTextFormat={true}`で表示され、赤字で「未保存」と示されます。
    -   既に保存されている場合: `SavedRouteCard`はグレー文字で「保存済み」と示されます。
    -   `currentRoute`が空の場合は表示されません。
-   **保存済み経路**:
    -   `localStorage`に保存された複数の経路が`SavedRouteCard`として列挙されます。
    -   並べ替え順は新しい順（追加された順）です。

### フッター部（画面下部）

左から順にアイコン配置:

1.  **[インポート]** (`DownloadIcon`): 経路データのインポート
2.  **[エクスポート]** (`UploadIcon`): 経路データのエクスポート
3.  **[保存]** (`SaveIcon`): 現在の経路を保持経路リストに保存

## 動作

### 編集モード

画面右上の`[編集]` (`EditIcon`) をタップ時:

1.  `[編集]`ボタンが`[完了]` (`CheckIcon`) に変化します。
2.  リストの各`SavedRouteCard`の右端に``[削除]`` (`DeleteIcon`) アイコンが表示されます。
3.  ``[削除]``をタップ → その経路が保持経路リストから削除されます。確認ダイアログなしで即座に削除されます。
4.  `[完了]`をタップ → 編集モードが終了します。

-   **並べ替えはできません**。

### リスト行の選択動作

-   `SavedRouteCard`をタップ → その経路でメイン画面の経路を置き換え、**<メイン>** 画面へ戻ります。
-   **<メイン>** 画面の経路が保持経路リストにもきっぷホルダリストにも存在しない場合:
    -   「⚠️経路は保存されていません。上書きしてよろしいですか？」という確認ダイアログを表示します。
    -   `[はい]`を選択した場合: 選択した経路をメイン画面に表示して遷移します。
    -   `[いいえ]`を選択した場合: 何もせずに、元の **<経路保存>** 画面へ戻ります。

### **[インポート]**

-   クリップボード内の経路テキストをインポートします。
-   「経路をインポートしてよろしいですか？」という確認ダイアログを表示します。選択肢は``[はい]``|``[いいえ]``です。
-   インポートの結果、書式エラーがあった場合、詳細なエラーメッセージ（例: 「経路の書式不正により、インポートに失敗しました: _2_ 行目、_新宿駅_」）を表示するアラートメッセージが表示されます。
-   インポートした経路は`localStorage`へ保存され、リストの先頭に追加されます。

### **[エクスポート]**

-   全ての保持経路をテキスト形式でエクスポートします。
-   `WebShare API`またはクリップボードを使用して共有します。
-   経路は`routeScript()`の文字列配列を改行で区切ったテキスト形式でエクスポートします。

### **[保存]**

-   現在の経路 (`currentRoute`) が保存済みリストに存在しない場合、`localStorage`へ保存し、リストの先頭に追加します。

## データソース

-   `currentRoute` (Svelte Store)
-   `savedRoutes` (Svelte Store、`localStorage`に永続化)
-   `ticketHolder` (Svelte Store、`localStorage`に永続化、経路が保持されているか確認するため)
-   経路のインポートには `Farert.buildRoute()` を使用します。エラーハンドリングは `buildRoute()` の戻り値 (`0`以外がエラー) と `try-catch` で行います。