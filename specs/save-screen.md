# **<経路保存>** 画面の詳細仕様

## 呼び出し画面

- **<メイン>** 画面 
  - ``[📁ファイルフォルダ]``

## 入力パラメーター

- ``route as 経路``

## レイアウト

### 1行目 画面タイトル

- 左端: `[戻る]`アイコン
- 中央: "保持経路"
- 右端: `[編集]`ボタン / ✔️（編集モード時）

### リストタイトル

- なし

### リスト表示エリア

- 保持経路の文字列を1行ずつ表示（例: _東京,東海道線,熱海,東海道線,静岡_）
- 半角カンマで区切った長い文字列のため、折り返して複数行表示される
- 先頭行: **<メイン>** 画面で表示されている現在の経路 ``route as 経路``
  - 保存されていない場合: 赤字表示
  - 保存されている場合: グレー文字表示
  - ``route as 経路`` が空の場合なし
- 以降の行は、Web Storage に保存された複数の経路を列挙する
- 並べ替え順は新しい順

### フッター部（画面下部）

左から順にアイコン配置:

1. ``[インポート]``: 経路データの読み込み
2. ``[エクスポート]``: 経路データの書き出し
3. ``[保存]``: 現在の経路を保持経路リストに保存

## 動作

### 編集モード

`[編集]`をタップ時:

1. `[編集]`ボタンが ``[✔️]`` に変化
2. リストの各行左端に ``[⛔️]`` アイコンを表示
3. ``[⛔️]`` をタップ → その行の右端に ``[削除]`` という**赤反転文字列**が表示
4. ``[削除]`` をタップ → その行が削除される

- 並べ替えはできません

### リスト行の選択動作

- 行を選択 → その経路で **<メイン>** 画面の経路を置き換える → **<メイン>** 画面へ戻る
- **<メイン>** 画面の経路 ``route as 経路`` が以下の両方に存在しない場合:
  - 保持経路リスト
  - きっぷホルダリスト
- "⚠️経路は保存されていません" という警告メッセージを表示
  - ``[破棄して選択した経路を表示]``
  - というボタンを表示し、クリックしたらその経路を **<メイン>** 画面に表示して遷移する。
  - キャンセルの場合、元の **<経路保存>** 画面へ戻る。

### ``[インポート]``

- 経路データの読み込み
- クリップボード内の、経路テキストをインポートする
- "経路インポートしてよろしいですか？" とダイアログメッセージを表示する。選択肢は ``[[OK]]``|``[いいえ]``
- インポートした結果、書式エラーのあった単語（駅または路線）を表示すしたアラートメッセージを表示する。
  - "経路の書式不正により、インポートに失敗しました: _2_ 行目、_新宿駅_"
  - "_5_ 経路をインポートし、_2_ 経路は失敗しました。_1_ 経路は既に存在しています"
  - のようなアラートメッセージを表示する。選択肢は、 ``[了解]``
- インポートした経路は WebStorage へ保存され、リストの先頭に追加する

### ``[エクスポート]``: 経路データの書き出し

- すべての保持経路をテキストでエクスポートする。
- WebShare API または、クリップボードで共有する
- 経路のエクスポート
  - 文字列配列なので、配列を改行で区切った文字列に変換してエクスポートする

### ``[保存]``: 現在の経路を保持経路リストに保存

- 先頭行に、**<メイン>** 画面の経路があり、保存されていなければ、WebStorage へ保存する

## データソース

- **<メイン>** 画面が保持していた経路 ``route``
- Web Storage へ保存された経路リスト
- 経路のインポート
  - `wasm.setupRouteByScript(route: string): Number
