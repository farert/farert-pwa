# 発駅選択画面の詳細仕様

## UI仕様凡例

| 項目         | 意味・用途                                           | 表記例                     |
|--------------|------------------------------------------------------|----------------------------|
| 変数名       | コード上で使用する識別子。UIとは直接関係しない。     | `station`                 |
| 画面名       | UI上の画面タイトルやセクション名。固定表示。         | **経路選択**              |
| ボタンラベル | UI上のボタンに表示される文字列。ユーザー操作対象。   | `追加`                    |
| 表示名       | UI上に**固定で表示されるラベル名**。動的ではない。   | `"路線"`                  |
| 表示例       | 表示名の下などに**動的に表示される値の一例**。       | _三重_                    |

---

- **発駅選択**画面は、メイン画面から、`発駅選択`から遷移、またはメイン画面から`追加`から**路線選択**画面の`着駅選択(最短経路)`からの2ソースより遷移する。

- **発駅選択**画面は、画面上部のタブによる切り替えで3つのビューと、画面上部のタブの下に表示された検索バーをクリックすることによりさらにもうひとつのビューを持つ
  - タブ
    - `グループ`
    - `都道府県`
    - `履歴`
  - 検索バー
    - インクリメンタル検索

各ビューでリストされた項目は、"路線"、"駅" の2種類で、"路線"を選択した場合、さらに**駅一覧**画面へ遷移する。

以下に各ビューの各行を選択したときの遷移画面を記す

    - `グループ`：路線 →　駅
    - `都道府県`：路線 →　駅
    - `履歴`：駅
    - インクリメンタル検索：駅

最終的には"駅"を選択してメイン画面へ返す。
`追加`による、**路線選択**画面では、"路線"と"駅"を返し、それ以外はすべて"駅"を返す

## 画面タイトル

- **発駅選択**
  (/station-select?type=start)
- **着駅選択(最短経路)**
  (/station-select?type=destination)

## レイアウト構成

### 1行目

- センタリングでタイトル表示

### 2行目（タブバー）

- **左端**: `戻る`ボタン
- **中央**: タブ（センタリング）
  - `グループ` | `都道府県` | `履歴`
- **右端**: `編集`ボタン（履歴選択時のみ有効）

### 3行目（検索バー）

- 検索アイコン + テキスト入力バー

### 4行目以降（リスト表示エリア）

タブに応じて内容が切り替わる

## タブ別の表示内容

### グループタブ

- JRグループ会社名を6行表示（例: _JR北海道_、_JR東日本_、_JR東海_、_JR西日本_、_JR四国_、_JR九州_）
- 選択 → **路線一覧**表示 → **駅一覧**表示 → 駅選択 → **メイン**画面へ戻る

### 都道府県タブ

- 都道府県を46行表示（沖縄を除く）（例: _北海道_、_青森_、_岩手_、...）
- 選択 → **路線一覧**表示 → **駅一覧**表示 → 駅選択 → **メイン**画面へ戻る

### 履歴タブ

- 過去に選択した駅を最近順に表示
- webストレージに保存
- 駅を選択 → **メイン**画面へ戻る

#### 履歴の編集モード

`編集`をタップ時:

- 駅一覧の左端に⛔️（侵入禁止マーク）アイコン表示
- アイコンタップで削除可能
- **画面最下部**:
  - `クリア`ボタン: 全消去
  - Undoアイコン: 削除の取り消し

## 検索機能

### 検索バークリック時の動作

1. 検索バーが1行目に移動
2. 右端に✖️アイコンが表示される
3. 検索文字を入力すると駅が絞り込まれる
4. 一致件数と一致した駅一覧を表示

### 検索結果の表示形式

```
駅名（例: 東京）
ひらがな (都道府県)（例: とうきょう (東京都)）
```

### 検索からの選択

- 駅を選択 → 戻り値として**メイン**画面へ
- ✖️をタップ → タブ表示に戻る

## データソース

- WASM
  - 路線、都道府県、グループはWASMモジュールから取得
    - wasm.listLinesByPrefecture(prefecture: string):string[]
    - wasm.listLinesByJRGroup(jrgroup: string):string[]
  - ひらがな
    - wasm.getHiraganaByStationName(stationName: string):strin
  - 所属都道府県
    - wasm.getPrefectureByStation(stationName: string): string
- 履歴検索
  - listLinesFromHistoryStorage():string[]
- 開発時は仮のスタブを利用

---

# 路線選択画面の詳細仕様

**路線選択**画面は**発駅選択**画面の以下のビューからの遷移と、**メイン**画面の`追加`による**経路追加**からの遷移する

- **発駅選択**画面
  - `グループ`: start | destination
  - `都道府県` : start | destination
- **メイン**画面`追加` : main

入力引数は、`from`=main, `from`=start, `from`=destination
で、さらに以下のパターンで呼ばれる

- `from`=main : `line`, `station`
- `from`=main : `station`
- `from`=start : `prefect`
- `from`=destination : `prefect`
- `from`=start : `group`
- `from`=destination : `group`

の呼び出しパターンがある。

## レイアウト

### 路線選択画面 1行目

- **左端**: `戻る`
- **中央**: タイトル**路線**
- **右端**: `最短経路`

- `from`=main のときのみ、右端に`着駅選択(最短経路)`ボタンラベル

### 路線選択画面 2行目: リストタイトル

- `from`=main は `station` で、駅名を表示（例: _東京_）
- `from`=start?prefect=xxx は、都道府県名を表示（例: _東京都_）
- `from`=start?group=xxx は、JRグループ名を表示（例: _JR東日本_）
- `from`=destination?prefect=xxx は、都道府県名を表示（例: _東京都_）
- `from`=destination?group=xxx は、JRグループ名を表示（例: _JR東日本_）

### 路線選択画面 3行目以降

#### `from`=main

- 駅の所属する路線名を列挙
- 入力パラメーターの `line`と一致する路線は、反転表示して選択できないようにする。背景色はテーマカラーで良い

#### (`from`=start or `from`=destination) and `group` is not null

- JRグループに属する路線名を列挙（例: _東海道線_、_中央線_、_山手線_、...）

#### (`from`=start or `from`=destination) and `prefect` is not null

- 都道府県に属する路線名を列挙（例: _東海道線_、_中央線_、_京浜東北線_、...）

## 路線選択画面の動作

### 行 `路線` を選択

- **駅選択** 画面へ遷移
- **駅選択** 画面への引数は以下の通り
  - `from`=main?`line`=xxx
  - `from`=main?`line`=xxx&`station`=yyy
  - `from`=start?`prefect`=aaa&`line`=xxx
  - `from`=start?`group`=bbb&`line`=xxx
  - `from`=destination?`prefect`=aaa&`line`=xxx
  - `from`=destination?`group`=bbb&`line`=xxx

### ボタンラベル `最短経路`をタップ

- **発駅選択**と同様の画面を表示
  (/station-select?type=destination)

---

# 駅選択画面の詳細仕様

## レイアウト

- **リストタイトル**: グループ名または都道府県 - 路線名（例: _JR東日本 - 東海道線_）
- **リスト表示形式**:

```
駅名（例: 東京）
(ひらがな) / 所属路線 / 所属路線…（例: (とうきょう) / 東海道線 / 中央線 / 京浜東北線）
```

## 動作

- 駅を選択 → 戻り値として**メイン**画面へ

---

# 駅選択画面（経路追加用）の詳細仕様

## 画面タイトル

- 初期状態: **分岐駅選択**
- 切り替え後: **着駅選択**

## ヘッダー部

- **左端**: `戻る`
- **中央**: 画面タイトル（**分岐駅選択** / **着駅選択**）
- **右端**: `着駅選択` / `分岐駅選択`（トグル切り替えボタン）

## リスト表示

- **リストタイトル**: 前画面で選択した路線名（例: _東海道線_）
- **リスト表示形式**:

```
駅名（例: 東京）
(ひらがな) / 所属路線 / 所属路線…（例: (とうきょう) / 東海道線 / 中央線 / 京浜東北線）
```

### 分岐駅選択モード

- **メイン**画面の前経路の着駅（この路線の発駅）と一致した駅の行を**反転表示**し、選択不可にする

### 着駅選択モード

右端の`着駅選択`をタップ時:

- 画面タイトルが**着駅選択**に切り替わる
- 分岐駅以外の全駅を表示
- リスト内容は分岐駅選択と同じ
- 右端のボタンは`分岐駅選択`表示に変わり、交互に切り替え可能

## 駅選択時の動作

- 選択した駅と前に選択した路線を戻り値として**メイン**画面へ戻る
