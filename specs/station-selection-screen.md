# 駅選択画面の詳細仕様

## 呼び出し画面

**<路線選択>** 画面からのみ呼ばれる
ただし、**<路線選択>** 画面が2ソース、2パターンで呼ばれるので、それに応じた表示と動作を行う必要がある。

## 入力パラメーター

以下の6パターンで呼ばれる

|パラメーター|パラメーター2|パラメーター3|
|-----|-----|-----|
|``from=main``|``staion``=_xxxx_|``line``=_yyyy_|
|``from=start``</br>``from=destination``|``line``=_xxxx_|``prefect``=_aaaa_|
|``from=start``</br>``from=destination``|``line``=_xxxx_|``group``=_aaaa_|

## レイアウト

表示・動作は、以下の２つに分類される.

1. ``from=main`` : 経路選択
2. ``from=start`` or ``from=destination`` : 発着駅選択

以降、'路線選択' と、 '発着駅選択' と条件分けする。さらに、パラメーター2、パラメーター3により分岐する場合がある。

### 1行目： 画面タイトル

- 左端: `戻る`
- 中央: 画面タイトル（以下参照）
- 右端: '路線選択' のときにのみ、 ``[着駅選択]``  /  ``[分岐駅選択]``（トグル切り替えボタン）

#### '路線選択' の画面タイトル

- 初期状態
  - "分岐駅選択"
- 切り替え後
  - "着駅選択"

- 初期状態は、"分岐駅指定" 、詳細は 「動作」 で説明する
- 右端に、 ``[着駅選択]``  または、  ``[分岐駅選択]`` ラベルボタン

#### '発着駅選択' の画面タイトル

- ``from=start``
  - "発駅指定"
- ``from=destination``
  - "着駅指定"

### 2行目 リストタイトル

- '路線選択'
  - "路線"

- '発着駅選択'
  - ``prefect`` あり？
    - `都道府県名` - `路線`
    - 例：
      - _神奈川県_ - _横浜線_
  - ``group`` あり？
    - `JRグループ名` - `路線`
    - 例：
      - _神奈川県_ - _横浜線_

### 3行目以降: リスト

- 画面タイトル == "分岐駅指定"
- ``prefect`` も``group`` もなく、``station`` と ``line`` が指定され、``from=main``
  - `station` でしめす駅を含む路線に属する分岐駅一覧を列挙する
- 画面タイトル == "着駅指定"
- ``prefect`` も``group`` もなく、``station`` と ``line`` が指定され、``from=main``
  - 路線に属する駅一覧を列挙する
- '発着駅選択'
  - ``prefect`` あり？
    - ``prefect``の都道府県内の路線内の `_駅_` 一覧
  - ``group`` あり？
    - ``group`` のJRグループ会社の路線ないの `_駅_`  一覧

#### リスト表示形式

各行は、以下で統一する

```
駅名（例: 東京）
(ひらがな) / 所属路線 / 所属路線…
```

- 1行目は通常文字で、2行目の文字は70%ほど小さく

#### 例

```
東京
(とうきょう) / 東海道線 / 中央線 / 京浜東北線
```

## 動作

### '路線選択' の画面制御

#### 分岐駅選択モード

- 画面タイトル行の右端 ``[着駅選択]`` をタップ時:
  - 画面タイトルが ``[着駅選択]`` に切り替わる
  - 画面タイトル行の右端が ``[分岐駅選択]`` に切り替わる
  - リストは、分岐駅以外の全駅を列挙
  - **<メイン>** 画面の前経路の着駅（この路線の発駅）と一致した駅の行を**反転表示**し、選択不可にする

#### 着駅選択モード

- 画面タイトル行の右端 ``[分岐駅選択]`` をタップ時:
  - 画面タイトルが ``[分岐駅選択]`` に切り替わる
  - 画面タイトル行の右端が ``[着駅選択]`` に切り替わる
  - リストは、パラメータ ``station`` を含む駅と、分岐駅とを列挙
  - **<メイン>** 画面の前経路の着駅（この路線の発駅）と一致した駅の行を**反転表示**し、選択不可にする

- 右端の ``[分岐駅選択]`` / ``[着駅指定]`` 表示は交互に切り替え可能
- 交互に切り替える時のトランジションは回転っぽいアニメーションにする。

### '発着駅選択' の画面制御

- タイトル行の ``[ボタンラベル]`` はないため、画面制御はおこなわない

## 駅選択時の動作（共通）

- 選択した駅と前に選択した路線を戻り値として**メイン**画面へ戻る

## データソース

- 駅の所属路線を返す
  - `getLinesByStation(station : string) : string []`
- 指定した駅も含め路線の分岐駅一覧を返す
  - `getBranchStationsByLine(line: string, station: string) : string []`
- 駅名のかなを得る
  - `wasm.getHiraganaByStationName(stationName: string):string`
- 路線の駅一覧を返す
  - `getStationsByLineAndPrefecture(line : string):string []`
