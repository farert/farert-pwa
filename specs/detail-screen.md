# 詳細画面（結果表示画面）の詳細仕様

詳細画面は、経路の計算結果（運賃、営業キロ、有効日数など）を詳細に表示する画面です。URLパラメータから圧縮された経路データを復元し、WASMモジュールで運賃計算を行い結果を表示します。

## 画面構成

`component-design.md`で定義されている以下のコンポーネントを使用して構成されます。

1.  **RouteHeader**:
    -   経路の起点と終点を表示します。
    -   Props: `startStation`, `endStation`

2.  **KilometerCard**:
    -   営業キロ、計算キロ、JR各社別キロ程などを表示します。
    -   Props: `fareInfo: FareInfo`
    -   表示される情報は`fareInfo`の内容に応じて動的に変化します（例: JR各社別キロ程、規程114条適用、JR線・会社線・BRT線の内訳など）。詳細は後述の「セクション2: キロ程」の内容に準じます。

3.  **FareCard**:
    -   普通運賃、往復運賃、小児運賃、学割運賃、株主優待割引運賃などを表示します。
    -   Props: `fareInfo: FareInfo`
    -   表示される情報は`fareInfo`の内容に応じて動的に変化します（例: 往復割引、各種割引運賃など）。詳細は後述の「セクション3: 運賃」の内容に準じます。

4.  **備考セクション**:
    -   特記事項がある場合にメッセージを表示します。

5.  **有効日数セクション**:
    -   有効日数と途中下車に関する情報を表示します。

6.  **経由セクション**:
    -   経路リストと、IC運賃計算経路を表示します。

これらのコンポーネントおよびセクションはスクロール可能な形式で表示されます。

## ナビゲーションバー

### タイトル
-   メインタイトル: 着駅名（例: _熱海_）
-   サブタイトル（prompt）: 発駅名 →（例: _東京 →_）

### 右上ボタン

1.  `共有`ボタン (`ShareIcon`):
    -   タップでシステム共有シートを表示（Web Share API）。
    -   経路の詳細URLを共有（圧縮形式）。`url-routing.md`を参照。
    -   Web Share APIが利用できない場合はクリップボードにURLをコピーするフォールバックを提供します。

## セクション1: 区間 (RouteHeaderコンポーネント)

`RouteHeader`コンポーネントとして表示されます。

-   内容: 発駅 → 着駅（例: _東京 → 熱海_）

## セクション2: キロ程 (KilometerCardコンポーネント)

`KilometerCard`コンポーネントとして表示されます。表示される詳細な内容は`fareInfo`オブジェクトに基づきます。

### タイトル
-   「キロ程」

### 表示項目例（条件付き表示）

-   **営業キロ・計算キロ**: `fareInfo.totalSalesKm`, `fareInfo.jrCalcKm`
-   **JR各社別キロ程**: `fareInfo`内の各JR会社の営業キロ・計算キロ (0でない場合)
-   **規程114条適用**: `fareInfo.rule114Km` (適用される場合)
-   **JR線・会社線・BRT線の内訳**: `fareInfo.jrKm`, `fareInfo.companyKm`, `fareInfo.brtKm` (それぞれ0でない場合)

## セクション3: 運賃 (FareCardコンポーネント)

`FareCard`コンポーネントとして表示されます。表示される詳細な内容は`fareInfo`オブジェクトに基づきます。

### タイトル
-   「運賃」

### 表示項目例（条件付き表示）

-   **普通運賃**: `fareInfo.fare`。会社線運賃、IC運賃、BRT運賃の内訳 (`fareInfo.companyFare`, `fareInfo.icFare`, `fareInfo.brtFare`)
-   **往復運賃**: `fareInfo.roundTripFare` (片道営業キロ ≥ 601km かつ往復割引適用時)
-   **規程114条 適用しない運賃**: `fareInfo.fareExcludingRule114` (規程114条適用時)
-   **株主優待割引運賃**: `fareInfo`内のJR各社別割引運賃 (利用可能な場合)
-   **小児運賃**: `fareInfo.childFare`, `fareInfo.roundtripChildFare`
-   **学割運賃**: `fareInfo.academicFare`, `fareInfo.roundtripAcademicFare` (片道営業キロ ≥ 101km の場合のみ表示)

## セクション4: 備考（条件付き表示）

特記事項がある場合にメッセージを表示します。表示されるメッセージは`fareInfo`オブジェクト内の特定のフラグや情報に基づきます。

-   例: 「近郊区間内の最短経路利用」、「BRT乗継ぎ割引適用」など。

## セクション5: 有効日数

### タイトル
-   「有効日数」

### 表示項目

-   有効日数: `fareInfo.ticketAvailDays`
-   途中下車情報: `fareInfo`内のフラグに基づいて以下のメッセージを表示。
    -   片道営業キロ ≥ 101km の場合: 「(途中下車可能)」
    -   発着駅が都区市内駅の場合: 「(発駅都区市内の駅を除き途中下車可能)」など。
    -   片道営業キロ < 101km の場合: 「(途中下車前途無効)」
    -   近郊区間内の場合: 「近郊区間内ですので最安運賃の経路にしました(途中下車不可、有効日数当日限り)」

## セクション6: 経由

### タイトル
-   「経由」

### 表示項目

-   **経路リスト**: `Farert`オブジェクトの経路情報 (`getRoutesJson()`) を元に、`[路線名]着駅[路線名]着駅...`形式で表示します。（例: _[東海道線]熱海[身延線]甲府_）
    -   これは表示用のフォーマットであり、内部の`routeScript()`のカンマ区切り形式とは異なります。
-   **IC運賃計算経路（条件付き）**: IC運賃の経路が普通運賃と異なる場合、そのIC運賃計算経路を上記と同じ形式で表示します。

## オプションメニュー内容（条件付き表示）

`option-menu.md`で定義された経路オプションが提供されます。`ui-guidelines.md`のオプションメニューの実装例に従い、条件が満たされた場合のみ表示されます。

## エラー表示

経路が不完全または無効な場合、画面上部にエラーバナーを表示します（`ui-guidelines.md`のエラー表示パターンを参照）。

-   例: 「無効な経路」、「経路が不完全です。続けて指定してください」、「会社線のみ運賃は表示できません」など。

## サブタイトルバー色の定義

`design-tokens.md`に以下を追加します。
`--color-subtitle-bar-bg: var(--color-gray-100);` (`#F5F5F5`)
これにより、サブタイトルバーの背景色として`gray-100`を使用します。