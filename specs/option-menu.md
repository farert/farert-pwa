# オプションメニューの詳細仕様

## UI仕様凡例

| 項目         | 意味・用途                                           | 表記例                     |
|--------------|------------------------------------------------------|----------------------------|
| 変数名       | コード上で使用する識別子。UIとは直接関係しない。     | `station`                 |
| 画面名       | UI上の画面タイトルやセクション名。固定表示。         | **経路選択**              |
| ボタンラベル | UI上のボタンに表示される文字列。ユーザー操作対象。   | `追加`                    |
| 表示名       | UI上に**固定で表示されるラベル名**。動的ではない。   | `"路線"`                  |
| 表示例       | 表示名の下などに**動的に表示される値の一例**。       | _三重_                    |

---

## メニュー概要

**メイン**画面下部の`オプション`アイコンから開くメニューで、経路計算の特殊ルールを設定できる。

## メニュー項目

### 1. 大阪環状線の経路選択

**表示条件:**
- 経路に大阪環状線が含まれる場合のみ有効

**メニュー項目:**
- `大阪環状線 近回り`
- `大阪環状線 遠回り`

**動作:**
- 選択すると経路を再計算し、運賃を更新
- **メイン**画面と**詳細**画面の表示が更新される

### 2. 小倉-博多間 新幹線・在来線別線扱い

**表示条件:**
- 経路に小倉-博多間が含まれる場合のみ有効

**メニュー項目:**
- `小倉-博多間新幹線在来線別線扱い（有効）`
- `小倉-博多間新幹線在来線別線扱い（無効）`

**動作:**
- 選択すると経路を再計算し、運賃を更新
- 有効時は新幹線と在来線を別路線として扱う
- 無効時は同一路線として扱う

## 共通の動作

### 選択時の処理

1. ユーザーがメニュー項目を選択
2. 経路オブジェクトのオプション設定を変更
3. 運賃を再計算（WASMモジュール呼び出し）
4. **メイン**画面の営業キロ・運賃表示を更新
5. メニューを閉じる

### メニューの表示形式

- アクションシート形式（iOS）またはボトムシート形式（Android）
- 該当する経路でない場合、メニュー項目は表示されない
- `キャンセル`ボタンで閉じる

## ボタンの有効/無効状態

**メイン**画面下部の`オプション`ボタンは以下の条件で有効化:
- 大阪環状線が経路に含まれる、または
- 小倉-博多間が経路に含まれる

上記条件を満たさない場合はグレーアウトで無効。

## 技術実装メモ

- オプション設定はWASMモジュールの経路オブジェクトに保存
- localStorageへの永続化は不要（経路ごとの一時設定）
- 経路を変更すると設定はリセットされる
